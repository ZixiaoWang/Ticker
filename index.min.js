System.register("index",[],function(exports_1,context_1){"use strict";var __moduleName=context_1&&context_1.id,WORKER,Timer;return{setters:[],execute:function(){WORKER="\n    self.addEventListener(\n        'message',\n        function(event){\n            var message = event.data.split(':');\n            var cmd = message[0];\n            var ID = message[1];\n            var delay = parseInt(message[2]);\n\n            switch(cmd) {\n                case 'calibrate':\n                    self.postMessage('calibrate:' + ID);\n                    break;\n                case 'createTimeout':\n                    var $timeout = setTimeout(function(){\n                        self.postMessage('timeout:' + ID + ':' + $timeout);\n                    }, delay);\n                    self.postMessage('createTimeout:' + ID + ':' + $timeout);\n                    break;\n                case 'createInterval':\n                    var $interval = setInterval(function(){\n                        self.postMessage('interval:' + ID + ':' + $interval);\n                    }, delay);\n                    self.postMessage('createInterval:' + ID + ':' + $interval);\n                    break;\n                case 'clearTimeout':\n                    clearTimeout(ID);\n                    break;\n                case 'clearInterval':\n                    clearInterval(ID);\n                    break;\n            }\n        },\n        false\n    );\n",Timer=function(){function Timer(){this.intervalMap=new Map,this.timeoutMap=new Map,this.immediateSet=new Set,this.timeError=0,this.immediateCount=0,this.timerID=0,this.worker=new Worker(URL.createObjectURL(new Blob([WORKER],{type:"application/javascript"}))),this.$setWorkerEventListener()}return Timer.prototype.calibrate=function(){var e=Date.now();this.worker.postMessage("calibrate:"+e.toString())},Timer.prototype.setTimeout=function(e,t){for(var a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];var r=t||0;r>this.timeError&&(r-=this.timeError);var n=this.$getRandomCode();return this.timeoutMap.set(n,{fn:e,delay:r,params:a||[],status:!1,timer:0}),this.worker.postMessage("createTimeout:"+n+":"+r),n},Timer.prototype.setInterval=function(e,t){for(var a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];var r=t||0,n=this.$getRandomCode();return this.intervalMap.set(n,{fn:e,delay:r,params:a||[],status:!1,timer:0}),this.worker.postMessage("createInterval:"+n+":"+r),n},Timer.prototype.setImmediate=function(functionOrCode){function immediateCallback(event){window.removeEventListener("message",immediateCallback),event.data===postMessage&&("function"==typeof functionOrCode?functionOrCode.apply(scope,params):eval(functionOrCode))}for(var params=[],_i=1;_i<arguments.length;_i++)params[_i-1]=arguments[_i];if(window.setImmediate){var immediateID=window.setImmediate.apply(window,[functionOrCode].concat(params));return this.immediateSet.add(immediateID),immediateID}var postMessage=Date.now().toString(16),scope=this;return window.addEventListener("message",immediateCallback),this.immediateCount++,window.postMessage(postMessage,"*"),this.immediateCount},Timer.prototype.clearTimeout=function(e){var t=this.intervalMap.get(e);t&&(this.worker.postMessage("clearInterval:"+t.timer),this.intervalMap.delete(e))},Timer.prototype.clearInterval=function(e){var t=this.intervalMap.get(e);t&&(this.worker.postMessage("clearInterval:"+t.timer),this.intervalMap.delete(e))},Timer.prototype.clearImmediate=function(e){if(window.clearImmediate)return clearImmediate(e),void this.immediateSet.delete(e)},Timer.prototype.clearAll=function(){var e=this;this.timeoutMap.forEach(function(t,a){e.clearTimeout(a)}),this.intervalMap.forEach(function(t,a){e.clearInterval(a)}),this.immediateSet.forEach(function(t){e.clearImmediate(t)})},Timer.prototype.hasTimer=function(e){return this.timeoutMap.has(e)||this.intervalMap.has(e)||this.immediateSet.has(e)},Timer.prototype.release=function(){this.worker.terminate(),this.intervalMap=new Map,this.timeoutMap=new Map,this.immediateSet=new Set},Timer.prototype.$setWorkerEventListener=function(){var _this=this;this.worker.addEventListener("message",function(event){var response=event.data.split(":"),cmd=response[0],ID=parseInt(response[1]),mark=response[2];switch(cmd){case"createTimeout":var timeoutInfo=_this.timeoutMap.get(ID);timeoutInfo&&(timeoutInfo.status=!0,timeoutInfo.timer=parseInt(mark));break;case"createInterval":var intervalInfo=_this.intervalMap.get(ID);intervalInfo&&(intervalInfo.status=!0,intervalInfo.timer=parseInt(mark));break;case"timeout":var timeoutInfo=_this.timeoutMap.get(ID);timeoutInfo&&timeoutInfo.status===!0&&("function"==typeof timeoutInfo.fn?timeoutInfo.fn.apply(_this,timeoutInfo.params):eval(timeoutInfo.fn));break;case"interval":var intervalInfo=_this.intervalMap.get(ID);intervalInfo&&intervalInfo.status===!0&&("function"==typeof intervalInfo.fn?intervalInfo.fn.apply(_this,intervalInfo.params):eval(intervalInfo.fn));break;case"calibrate":var recievedTime=Date.now(),sentTime=ID;_this.timeError=recievedTime-sentTime}})},Timer.prototype.$getRandomCode=function(){return++this.timerID},Timer}(),exports_1("Timer",Timer)}}});